INSERT INTO DATA_VAULT.CORE.HUB_STUDYLINK_APPLICATION (HUB_STUDYLINK_APPLICATION_KEY, APPLICATIONID, SOURCE, LOAD_DTS,
                                                       ETL_JOB_ID)
SELECT MD5(A.APPLICATIONID)                      HUB_STUDYLINK_APPLICATION_KEY,
       APPLICATIONID                             APPLICATIONID,
       'STUDYLINK'                               SOURCE,
       CURRENT_TIMESTAMP::timestamp_ntz          LOAD_DTS,
       'SQL' || CURRENT_TIMESTAMP::TIMESTAMP_NTZ ETL_JOB_ID
FROM (
         SELECT DF_APPLICATIONDETAILS_APPLICATIONID APPLICATIONID
         FROM ODS.STUDYLINK.STUDYLINK_APPLICATION_COURSE_API_LATEST
         UNION
         SELECT APPLICATIONID
         FROM ODS.STUDYLINK.STUDYLINK_APPLICATION_CSV_EXTRACT
     ) A
WHERE NOT EXISTS(
        SELECT 1
        FROM DATA_VAULT.CORE.HUB_STUDYLINK_APPLICATION S
        WHERE S.HUB_STUDYLINK_APPLICATION_KEY = MD5(A.APPLICATIONID)
    );

